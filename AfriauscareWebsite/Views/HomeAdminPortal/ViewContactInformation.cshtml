@model IEnumerable<Afriauscare.BusinessLayer.ContactInformation.ContactInformationModel>

@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title View Contact Information</title>
    @Styles.Render("~/Content/css")
    <script src="~/Scripts/jquery-3.3.1.min.js"></script>
    <script src="~/Scripts/bootstrap.js"></script>
</head>
<body>
    @Html.Partial("_MenuBarAdminPortal")
    <div class="container">
        <br />
        <h2>Contact Information</h2>
        <br />
        @if (TempData["ContactInformationAlertMessage"] != null)
        {
            <div id="DeleteContactInformationAlert" class="alert alert-success">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                <strong>Success!</strong> @TempData["ContactInformationAlertMessage"]
            </div>
        }

        <button type="submit" class="btn btn-primary" onclick="location.href='@Url.Action("CreateContactInformation", "HomeAdminPortal")'">Create Contact Information</button>
        <br />
        <br />
        <table class="table table-striped table-hover">
            <thead class="thead-dark">
                <tr>
                    <th scope="col">Contact Id</th>
                    <th scope="col">Email Address</th>
                    <th scope="col">Address</th>
                    <th scope="col">Phone Number</th>
                    <th scope="col">Is Default</th>
                    <th scope="col">Action</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@Html.DisplayFor(modelItem => item.Contact_id)</td>
                        <td>@Html.DisplayFor(modelItem => item.Email_address)</td>
                        <td>@Html.DisplayFor(modelItem => item.Contact_address)</td>
                        <td>@Html.DisplayFor(modelItem => item.Phone_number)</td>
                        <td>@Html.CheckBoxFor(modelItem => item.Is_default, new { @class = "form-check-input", @disabled = "disabled" })</td>
                        <td>
                            @Html.ActionLink("Edit", "ModifyContactInformation", new { ContactId = item.Contact_id }, new { @class = "btn btn-info" })
                            @if (item.Is_default)
                            {
                                <button class="btnDeleteContactInformation btn btn-danger" disabled title="A default record cannot be deleted">Delete</button>
                            }
                            else
                            {
                                <button class="btnDeleteContactInformation btn btn-danger">Delete</button>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        <input type="hidden" id="ContactIdHidden" />
    </div>

    <div class="modal fade" id="deleteContactInformationModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Confirmation</h4>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete the contact information selected?</p>
                    <strong><label id="lblAddress"></label></strong>
                </div>
                <div class="modal-footer">
                    <div class="btn-group">
                        <a href="#" id="btnConfirmDeleteContactInformation" class="btn btn-info mr-2">Confirm</a>
                        <a href="#" id="btnCancelDeleteContactInformationModal" class="btn btn-danger">Cancel</a>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {

            $("#btnCancelDeleteContactInformationModal").click(function () {
                window.location.href = "/HomeAdminPortal/ViewContactInformation";
            })

            //Function which is called when confirming disable a user - Jquery function added to the modal button
            $("#btnConfirmDeleteContactInformation").click(function () {
                var _id = $("#ContactIdHidden").val();

                $.ajax({
                    type: "POST",
                    url: "/HomeAdminPortal/DeleteContactInformationJson",
                    data: { ContactInformationId: _id },
                    success: function (result) {
                        if (result) {
                            $("#deleteContactInformationModal").modal('hide');
                            $("#ContactIdHidden").val(null);
                            window.location.href = "/HomeAdminPortal/ViewContactInformation";
                        }
                        else {
                            alert("The operation did not complete");
                        }
                    }
                });
            })
        })

        $(".btnDeleteContactInformation").click(function () {
            debugger;
            var currentTds = $(this).closest("tr").find("td"); // find all td of selected row
            var ContactInformationId = $(currentTds).eq(0).text();
            var Address = $(currentTds).eq(2).text(); // eq= cell , text = inner text
            $("#lblAddress").html(Address);
            $("#ContactIdHidden").val(ContactInformationId);
            $("#deleteContactInformationModal").modal('show');
        });

        setTimeout(function () {

            // Closing the alert message once the user is created
            $('#DeleteContactInformationAlert').alert('close');
        }, 5300);
    </script>
</body>
</html>
